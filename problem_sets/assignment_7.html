<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Assignment 7: Relational data plus revisiting data wrangling and visualization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="assignment_7_files/libs/clipboard/clipboard.min.js"></script>
<script src="assignment_7_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="assignment_7_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="assignment_7_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="assignment_7_files/libs/quarto-html/popper.min.js"></script>
<script src="assignment_7_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="assignment_7_files/libs/quarto-html/anchor.min.js"></script>
<link href="assignment_7_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="assignment_7_files/libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="assignment_7_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="assignment_7_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="assignment_7_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Assignment 7: Relational data plus revisiting data wrangling and visualization</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="load-packages" class="level2">
<h2 class="anchored" data-anchor-id="load-packages">Load packages</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.2
✔ ggplot2   4.0.0     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dslabs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="excercise-2016-election-result-and-polling" class="level1">
<h1>Excercise: 2016 election result and polling</h1>
<p>For this exercise, we will explore the result of the 2016 US presidential election as well as the polling data. We will use the following three datasets in the <code>dslabs</code> package, and use <code>join</code> function to connect them together. As a reminder, you can use <code>?</code> to learn more about these datasets.</p>
<p><code>results_us_election_2016</code>: Election results (popular vote) and electoral college votes from the 2016 presidential election.</p>
<p><code>polls_us_election_2016</code>: Poll results from the 2016 presidential elections.</p>
<p><code>murders</code>: Gun murder data from FBI reports. It also contains the population of each state.</p>
<p>We will also use this dataset to get the exact numbers of votes for question 3.</p>
<section id="question-1.-what-is-the-relationship-between-the-population-size-and-the-number-of-electoral-votes-each-state-has" class="level4">
<h4 class="anchored" data-anchor-id="question-1.-what-is-the-relationship-between-the-population-size-and-the-number-of-electoral-votes-each-state-has">Question 1. What is the relationship between the population size and the number of electoral votes each state has?</h4>
<p><strong>1a</strong>. Use a join function to combine the <code>murders</code> dataset, which contains information on population size, and the <code>results_us_election_2016</code> dataset, which contains information on the number of electoral votes. Name this new dataset <code>q_1a</code>, and show its first 6 rows.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>q_1a <span class="ot">&lt;-</span> murders <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(results_us_election_2016, <span class="at">by =</span> <span class="st">"state"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(q_1a))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 9%">
<col style="width: 5%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">state</th>
<th style="text-align: left;">abb</th>
<th style="text-align: left;">region</th>
<th style="text-align: right;">population</th>
<th style="text-align: right;">total</th>
<th style="text-align: right;">electoral_votes</th>
<th style="text-align: right;">clinton</th>
<th style="text-align: right;">trump</th>
<th style="text-align: right;">johnson</th>
<th style="text-align: right;">stein</th>
<th style="text-align: right;">mcmullin</th>
<th style="text-align: right;">others</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">AL</td>
<td style="text-align: left;">South</td>
<td style="text-align: right;">4779736</td>
<td style="text-align: right;">135</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">34.35795</td>
<td style="text-align: right;">62.08309</td>
<td style="text-align: right;">2.094169</td>
<td style="text-align: right;">0.4422682</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">1.0225246</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alaska</td>
<td style="text-align: left;">AK</td>
<td style="text-align: left;">West</td>
<td style="text-align: right;">710231</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">36.55087</td>
<td style="text-align: right;">51.28151</td>
<td style="text-align: right;">5.877128</td>
<td style="text-align: right;">1.8000176</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">4.4904710</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Arizona</td>
<td style="text-align: left;">AZ</td>
<td style="text-align: left;">West</td>
<td style="text-align: right;">6392017</td>
<td style="text-align: right;">232</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">44.58042</td>
<td style="text-align: right;">48.08314</td>
<td style="text-align: right;">4.082188</td>
<td style="text-align: right;">1.3185997</td>
<td style="text-align: right;">0.6699155</td>
<td style="text-align: right;">1.2657329</td>
</tr>
<tr class="even">
<td style="text-align: left;">Arkansas</td>
<td style="text-align: left;">AR</td>
<td style="text-align: left;">South</td>
<td style="text-align: right;">2915918</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">33.65190</td>
<td style="text-align: right;">60.57191</td>
<td style="text-align: right;">2.648769</td>
<td style="text-align: right;">0.8378174</td>
<td style="text-align: right;">1.1653206</td>
<td style="text-align: right;">1.1242832</td>
</tr>
<tr class="odd">
<td style="text-align: left;">California</td>
<td style="text-align: left;">CA</td>
<td style="text-align: left;">West</td>
<td style="text-align: right;">37253956</td>
<td style="text-align: right;">1257</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">61.72640</td>
<td style="text-align: right;">31.61711</td>
<td style="text-align: right;">3.374092</td>
<td style="text-align: right;">1.9649200</td>
<td style="text-align: right;">0.2792070</td>
<td style="text-align: right;">1.0382753</td>
</tr>
<tr class="even">
<td style="text-align: left;">Colorado</td>
<td style="text-align: left;">CO</td>
<td style="text-align: left;">West</td>
<td style="text-align: right;">5029196</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">48.15651</td>
<td style="text-align: right;">43.25098</td>
<td style="text-align: right;">5.183748</td>
<td style="text-align: right;">1.3825031</td>
<td style="text-align: right;">1.0400874</td>
<td style="text-align: right;">0.9861714</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="b.-add-a-new-variable-in-the-q_1a-dataset-to-indicate-which-candidate-won-in-each-state-and-remove-the-columns-abb-region-and-total.-name-this-new-dataset-q_1b-and-show-its-first-6-rows." class="level4">
<h4 class="anchored" data-anchor-id="b.-add-a-new-variable-in-the-q_1a-dataset-to-indicate-which-candidate-won-in-each-state-and-remove-the-columns-abb-region-and-total.-name-this-new-dataset-q_1b-and-show-its-first-6-rows."><strong>1b.</strong> Add a new variable in the q_1a dataset to indicate which candidate won in each state, and remove the columns abb, region, and total. Name this new dataset q_1b, and show its first 6 rows.</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>q_1b <span class="ot">&lt;-</span> q_1a <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">winner =</span> <span class="fu">ifelse</span>(clinton <span class="sc">&gt;</span> trump, <span class="st">"clinton"</span>, <span class="st">"trump"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>abb, <span class="sc">-</span>region, <span class="sc">-</span>total)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(q_1b))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">state</th>
<th style="text-align: right;">population</th>
<th style="text-align: right;">electoral_votes</th>
<th style="text-align: right;">clinton</th>
<th style="text-align: right;">trump</th>
<th style="text-align: right;">johnson</th>
<th style="text-align: right;">stein</th>
<th style="text-align: right;">mcmullin</th>
<th style="text-align: right;">others</th>
<th style="text-align: left;">winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alabama</td>
<td style="text-align: right;">4779736</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">34.35795</td>
<td style="text-align: right;">62.08309</td>
<td style="text-align: right;">2.094169</td>
<td style="text-align: right;">0.4422682</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">1.0225246</td>
<td style="text-align: left;">trump</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alaska</td>
<td style="text-align: right;">710231</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">36.55087</td>
<td style="text-align: right;">51.28151</td>
<td style="text-align: right;">5.877128</td>
<td style="text-align: right;">1.8000176</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">4.4904710</td>
<td style="text-align: left;">trump</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Arizona</td>
<td style="text-align: right;">6392017</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">44.58042</td>
<td style="text-align: right;">48.08314</td>
<td style="text-align: right;">4.082188</td>
<td style="text-align: right;">1.3185997</td>
<td style="text-align: right;">0.6699155</td>
<td style="text-align: right;">1.2657329</td>
<td style="text-align: left;">trump</td>
</tr>
<tr class="even">
<td style="text-align: left;">Arkansas</td>
<td style="text-align: right;">2915918</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">33.65190</td>
<td style="text-align: right;">60.57191</td>
<td style="text-align: right;">2.648769</td>
<td style="text-align: right;">0.8378174</td>
<td style="text-align: right;">1.1653206</td>
<td style="text-align: right;">1.1242832</td>
<td style="text-align: left;">trump</td>
</tr>
<tr class="odd">
<td style="text-align: left;">California</td>
<td style="text-align: right;">37253956</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">61.72640</td>
<td style="text-align: right;">31.61711</td>
<td style="text-align: right;">3.374092</td>
<td style="text-align: right;">1.9649200</td>
<td style="text-align: right;">0.2792070</td>
<td style="text-align: right;">1.0382753</td>
<td style="text-align: left;">clinton</td>
</tr>
<tr class="even">
<td style="text-align: left;">Colorado</td>
<td style="text-align: right;">5029196</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">48.15651</td>
<td style="text-align: right;">43.25098</td>
<td style="text-align: right;">5.183748</td>
<td style="text-align: right;">1.3825031</td>
<td style="text-align: right;">1.0400874</td>
<td style="text-align: right;">0.9861714</td>
<td style="text-align: left;">clinton</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="c.-using-the-q_1b-dataset-plot-the-relationship-between-population-size-and-number-of-electoral-votes.-use-color-to-indicate-who-won-the-state.-fit-a-straight-line-to-the-data-set-its-color-to-black-size-to-0.1-and-turn-off-its-confidence-interval." class="level4">
<h4 class="anchored" data-anchor-id="c.-using-the-q_1b-dataset-plot-the-relationship-between-population-size-and-number-of-electoral-votes.-use-color-to-indicate-who-won-the-state.-fit-a-straight-line-to-the-data-set-its-color-to-black-size-to-0.1-and-turn-off-its-confidence-interval."><strong>1c.</strong> Using the <code>q_1b</code> dataset, plot the relationship between population size and number of electoral votes. Use color to indicate who won the state. Fit a straight line to the data, set its color to black, size to 0.1, and turn off its confidence interval.</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(q_1b, <span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">y =</span> electoral_votes, <span class="at">color =</span> winner)) <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Population vs. Electoral Votes by State"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Population"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Electoral Votes"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Winner"</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="assignment_7_files/figure-html/label3-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="question-2.-would-the-election-result-be-any-different-if-the-number-of-electoral-votes-is-exactly-proportional-to-a-states-population-size" class="level2">
<h2 class="anchored" data-anchor-id="question-2.-would-the-election-result-be-any-different-if-the-number-of-electoral-votes-is-exactly-proportional-to-a-states-population-size">Question 2. Would the election result be any different if the number of electoral votes is exactly proportional to a state’s population size?</h2>
<section id="a.-first-convert-the-q_1b-dataset-to-longer-format-such-that-the-population-and-electoral_votes-columns-are-turned-into-rows-as-shown-below.-name-this-new-dataset-q_2a-and-show-its-first-6-rows." class="level4">
<h4 class="anchored" data-anchor-id="a.-first-convert-the-q_1b-dataset-to-longer-format-such-that-the-population-and-electoral_votes-columns-are-turned-into-rows-as-shown-below.-name-this-new-dataset-q_2a-and-show-its-first-6-rows."><strong>2a.</strong> First, convert the <code>q_1b</code> dataset to longer format such that the <code>population</code> and <code>electoral_votes</code> columns are turned into rows as shown below. Name this new dataset <code>q_2a</code>, and show its first 6 rows.</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>q_2a <span class="ot">&lt;-</span> q_1b <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(population, electoral_votes),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"measure"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(q_2a))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 16%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">state</th>
<th style="text-align: right;">clinton</th>
<th style="text-align: right;">trump</th>
<th style="text-align: right;">johnson</th>
<th style="text-align: right;">stein</th>
<th style="text-align: right;">mcmullin</th>
<th style="text-align: right;">others</th>
<th style="text-align: left;">winner</th>
<th style="text-align: left;">measure</th>
<th style="text-align: right;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alabama</td>
<td style="text-align: right;">34.35795</td>
<td style="text-align: right;">62.08309</td>
<td style="text-align: right;">2.094169</td>
<td style="text-align: right;">0.4422682</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">1.022525</td>
<td style="text-align: left;">trump</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">4779736</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alabama</td>
<td style="text-align: right;">34.35795</td>
<td style="text-align: right;">62.08309</td>
<td style="text-align: right;">2.094169</td>
<td style="text-align: right;">0.4422682</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">1.022525</td>
<td style="text-align: left;">trump</td>
<td style="text-align: left;">electoral_votes</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alaska</td>
<td style="text-align: right;">36.55087</td>
<td style="text-align: right;">51.28151</td>
<td style="text-align: right;">5.877128</td>
<td style="text-align: right;">1.8000176</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">4.490471</td>
<td style="text-align: left;">trump</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">710231</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alaska</td>
<td style="text-align: right;">36.55087</td>
<td style="text-align: right;">51.28151</td>
<td style="text-align: right;">5.877128</td>
<td style="text-align: right;">1.8000176</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">4.490471</td>
<td style="text-align: left;">trump</td>
<td style="text-align: left;">electoral_votes</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Arizona</td>
<td style="text-align: right;">44.58042</td>
<td style="text-align: right;">48.08314</td>
<td style="text-align: right;">4.082188</td>
<td style="text-align: right;">1.3185997</td>
<td style="text-align: right;">0.6699155</td>
<td style="text-align: right;">1.265733</td>
<td style="text-align: left;">trump</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">6392017</td>
</tr>
<tr class="even">
<td style="text-align: left;">Arizona</td>
<td style="text-align: right;">44.58042</td>
<td style="text-align: right;">48.08314</td>
<td style="text-align: right;">4.082188</td>
<td style="text-align: right;">1.3185997</td>
<td style="text-align: right;">0.6699155</td>
<td style="text-align: right;">1.265733</td>
<td style="text-align: left;">trump</td>
<td style="text-align: left;">electoral_votes</td>
<td style="text-align: right;">11</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="b.-then-sum-up-the-number-of-electoral-votes-and-population-size-across-all-states-for-each-candidate.-name-this-new-dataset-q_2b-and-print-it-as-shown-below." class="level4">
<h4 class="anchored" data-anchor-id="b.-then-sum-up-the-number-of-electoral-votes-and-population-size-across-all-states-for-each-candidate.-name-this-new-dataset-q_2b-and-print-it-as-shown-below."><strong>2b.</strong> Then, sum up the number of electoral votes and population size across all states for each candidate. Name this new dataset <code>q_2b</code>, and print it as shown below.</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>q_2b <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(value <span class="sc">~</span> winner <span class="sc">+</span> measure, <span class="at">data =</span> q_2a, sum)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>q_2b <span class="ot">&lt;-</span> q_2b <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">metric =</span> measure)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>q_2b <span class="ot">&lt;-</span> q_2b[, <span class="fu">c</span>(<span class="st">"metric"</span>, <span class="st">"winner"</span>, <span class="st">"value"</span>)]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(q_2b)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">metric</th>
<th style="text-align: left;">winner</th>
<th style="text-align: right;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">electoral_votes</td>
<td style="text-align: left;">clinton</td>
<td style="text-align: right;">231</td>
</tr>
<tr class="even">
<td style="text-align: left;">electoral_votes</td>
<td style="text-align: left;">trump</td>
<td style="text-align: right;">302</td>
</tr>
<tr class="odd">
<td style="text-align: left;">population</td>
<td style="text-align: left;">clinton</td>
<td style="text-align: right;">134982448</td>
</tr>
<tr class="even">
<td style="text-align: left;">population</td>
<td style="text-align: left;">trump</td>
<td style="text-align: right;">174881780</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="c.-use-the-q_2b-dataset-to-contruct-a-bar-plot-to-show-the-final-electoral-vote-share-under-the-scenarios-of-1-each-state-has-the-number-of-electoral-votes-that-it-currently-has-and-2-each-state-has-the-number-of-electoral-votes-that-is-exactly-proportional-to-its-population-size.-here-assume-that-for-each-state-the-winner-will-take-all-its-electoral-votes" class="level4">
<h4 class="anchored" data-anchor-id="c.-use-the-q_2b-dataset-to-contruct-a-bar-plot-to-show-the-final-electoral-vote-share-under-the-scenarios-of-1-each-state-has-the-number-of-electoral-votes-that-it-currently-has-and-2-each-state-has-the-number-of-electoral-votes-that-is-exactly-proportional-to-its-population-size.-here-assume-that-for-each-state-the-winner-will-take-all-its-electoral-votes"><strong>2c.</strong> Use the <code>q_2b</code> dataset to contruct a bar plot to show the final electoral vote share under the scenarios of <strong>1)</strong> each state has the number of electoral votes that it currently has, and <strong>2)</strong> each state has the number of electoral votes that is exactly proportional to its population size. Here, assume that for each state, the winner will take all its electoral votes</h4>
<p>Note: only two Oceanian countries are included in this dataset, and <code>geom_smooth()</code> does not work with two data points, which is why they are excluded.</p>
<p><em>Hint: <code>geom_col(position = "fill")</code> might be helpful.</em></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>q_2c <span class="ot">&lt;-</span> q_2b <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(metric) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">share =</span> value <span class="sc">/</span> <span class="fu">sum</span>(value))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(q_2c, <span class="fu">aes</span>(<span class="at">x =</span> metric, <span class="at">y =</span> share, <span class="at">fill =</span> winner)) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"metric"</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"value"</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"winner"</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="assignment_7_files/figure-html/label15-1.png" class="img-fluid" width="672"></p>
</section>
</section>
<section id="question-3.-what-if-the-election-was-determined-by-popular-votes" class="level2">
<h2 class="anchored" data-anchor-id="question-3.-what-if-the-election-was-determined-by-popular-votes">Question 3. What if the election was determined by popular votes?</h2>
<section id="a.-first-from-this-dataset-on-github-calculate-the-number-of-popular-votes-each-candidate-received-as-shown-below.-name-this-new-dataset-q_3a-and-print-it." class="level4">
<h4 class="anchored" data-anchor-id="a.-first-from-this-dataset-on-github-calculate-the-number-of-popular-votes-each-candidate-received-as-shown-below.-name-this-new-dataset-q_3a-and-print-it."><strong>3a.</strong> First, from this dataset on GitHub, calculate the number of popular votes each candidate received as shown below. Name this new dataset <code>q_3a</code>, and print it.</h4>
<p>*Note: Vote counts are listed for several other candidates. Please combine the votes for all candidates other than Clinton and Trump into a single <code>others</code> category (as shown in the table below)</p>
<p>Hint: <code>pivot_longer()</code> may be useful in here.*</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/kshaffer/election2016/master/2016ElectionResultsByState.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 51 Columns: 11
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): state, postal
dbl (9): clintonVotes, clintonElectors, trumpVotes, trumpElectors, johnsonVo...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>q_3a <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(clintonVotes, trumpVotes, johnsonVotes, steinVotes, mcmullinVotes, othersVotes),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"candidate"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"votes"</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">candidate =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    candidate <span class="sc">==</span> <span class="st">"clintonVotes"</span> <span class="sc">~</span> <span class="st">"clinton"</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    candidate <span class="sc">==</span> <span class="st">"trumpVotes"</span> <span class="sc">~</span> <span class="st">"trump"</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"others"</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(candidate) <span class="sc">%&gt;%</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">sum</span>(votes, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">metric =</span> <span class="st">"popular_votes"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">winner =</span> candidate) <span class="sc">%&gt;%</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(metric, winner, value)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(q_3a)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">metric</th>
<th style="text-align: left;">winner</th>
<th style="text-align: right;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">popular_votes</td>
<td style="text-align: left;">clinton</td>
<td style="text-align: right;">65125640</td>
</tr>
<tr class="even">
<td style="text-align: left;">popular_votes</td>
<td style="text-align: left;">others</td>
<td style="text-align: right;">7054974</td>
</tr>
<tr class="odd">
<td style="text-align: left;">popular_votes</td>
<td style="text-align: left;">trump</td>
<td style="text-align: right;">62616675</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="b.-combine-the-q_2b-dataset-with-the-q_3a-dataset.-call-this-new-dataset-q_3b-and-print-it-as-shown-below." class="level4">
<h4 class="anchored" data-anchor-id="b.-combine-the-q_2b-dataset-with-the-q_3a-dataset.-call-this-new-dataset-q_3b-and-print-it-as-shown-below."><strong>3b.</strong> Combine the <code>q_2b</code> dataset with the <code>q_3a</code> dataset. Call this new dataset <code>q_3b</code>, and print it as shown below.</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>q_3b <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(q_2b, q_3a) <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(metric, winner, value)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(q_3b)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">metric</th>
<th style="text-align: left;">winner</th>
<th style="text-align: right;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">electoral_votes</td>
<td style="text-align: left;">clinton</td>
<td style="text-align: right;">231</td>
</tr>
<tr class="even">
<td style="text-align: left;">electoral_votes</td>
<td style="text-align: left;">trump</td>
<td style="text-align: right;">302</td>
</tr>
<tr class="odd">
<td style="text-align: left;">population</td>
<td style="text-align: left;">clinton</td>
<td style="text-align: right;">134982448</td>
</tr>
<tr class="even">
<td style="text-align: left;">population</td>
<td style="text-align: left;">trump</td>
<td style="text-align: right;">174881780</td>
</tr>
<tr class="odd">
<td style="text-align: left;">popular_votes</td>
<td style="text-align: left;">clinton</td>
<td style="text-align: right;">65125640</td>
</tr>
<tr class="even">
<td style="text-align: left;">popular_votes</td>
<td style="text-align: left;">others</td>
<td style="text-align: right;">7054974</td>
</tr>
<tr class="odd">
<td style="text-align: left;">popular_votes</td>
<td style="text-align: left;">trump</td>
<td style="text-align: right;">62616675</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
</section>
<section id="c.-lastly-use-the-q_3b-dataset-to-contruct-a-bar-plot-to-show-the-final-vote-share-under-the-scenarios-of-1-each-state-has-the-number-of-electoral-votes-that-it-currently-has-2-each-state-has-the-number-of-electoral-votes-that-is-exactly-proportional-to-its-population-size-and-3-the-election-result-is-determined-by-the-popular-vote." class="level4">
<h4 class="anchored" data-anchor-id="c.-lastly-use-the-q_3b-dataset-to-contruct-a-bar-plot-to-show-the-final-vote-share-under-the-scenarios-of-1-each-state-has-the-number-of-electoral-votes-that-it-currently-has-2-each-state-has-the-number-of-electoral-votes-that-is-exactly-proportional-to-its-population-size-and-3-the-election-result-is-determined-by-the-popular-vote."><strong>3c.</strong> Lastly, use the <code>q_3b</code> dataset to contruct a bar plot to show the final vote share under the scenarios of <strong>1)</strong> each state has the number of electoral votes that it currently has, <strong>2)</strong> each state has the number of electoral votes that is exactly proportional to its population size, and <strong>3)</strong> the election result is determined by the popular vote.</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(q_3b, <span class="fu">aes</span>(<span class="at">x =</span> metric, <span class="at">y =</span> value, <span class="at">fill =</span> winner)) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span>                </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"metric"</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"value"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"winner"</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="assignment_7_files/figure-html/label19-1.png" class="img-fluid" width="672"></p>
<p><br></p>
</section>
</section>
<section id="question-4.-the-election-result-in-2016-came-as-a-huge-surprise-to-many-people-especially-given-that-most-polls-predicted-clinton-would-win-before-the-election.-where-did-the-polls-get-wrong" class="level2">
<h2 class="anchored" data-anchor-id="question-4.-the-election-result-in-2016-came-as-a-huge-surprise-to-many-people-especially-given-that-most-polls-predicted-clinton-would-win-before-the-election.-where-did-the-polls-get-wrong">Question 4. The election result in 2016 came as a huge surprise to many people, especially given that most polls predicted Clinton would win before the election. Where did the polls get wrong?</h2>
<section id="a.-the-polling-data-is-stored-in-the-data-frame-polls_us_election_2016.-for-the-sake-of-simplicity-we-will-only-look-at-the-data-from-a-single-poll-for-each-state.-subset-the-polling-data-to-include-only-the-results-from-the-pollster-ipsos.-exclude-national-polls-and-for-each-state-select-the-polling-result-with-the-enddate-closest-to-the-election-day-i.e.-those-with-the-lastest-end-date.-keep-only-the-columns-state-adjpoll_clinton-and-adjpoll_trump.-save-this-new-dataset-as-q_4a-and-show-its-first-6-rows." class="level4">
<h4 class="anchored" data-anchor-id="a.-the-polling-data-is-stored-in-the-data-frame-polls_us_election_2016.-for-the-sake-of-simplicity-we-will-only-look-at-the-data-from-a-single-poll-for-each-state.-subset-the-polling-data-to-include-only-the-results-from-the-pollster-ipsos.-exclude-national-polls-and-for-each-state-select-the-polling-result-with-the-enddate-closest-to-the-election-day-i.e.-those-with-the-lastest-end-date.-keep-only-the-columns-state-adjpoll_clinton-and-adjpoll_trump.-save-this-new-dataset-as-q_4a-and-show-its-first-6-rows."><strong>4a.</strong> The polling data is stored in the data frame <code>polls_us_election_2016</code>. For the sake of simplicity, we will only look at the data from a single poll for each state. Subset the polling data to include only the results from the pollster <code>Ipsos</code>. Exclude national polls, and for each state, select the polling result with the <code>enddate</code> closest to the election day (i.e.&nbsp;those with the lastest end date). Keep only the columns <code>state</code>, <code>adjpoll_clinton</code>, and <code>adjpoll_trump</code>. Save this new dataset as q_4a, and show its first 6 rows.</h4>
<p>*Note: You should have 47 rows in <code>q_4a</code> because only 47 states were polled at least once by <code>Ipsos</code>. You don’t need to worry about the 3 missing states and DC.</p>
<p>Hint: <code>group_by()</code> and <code>slice_max()</code> can be useful for this question. Check out the help file for <code>slice_max()</code> for more info.*</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>q_4a <span class="ot">&lt;-</span> polls_us_election_2016 <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pollster <span class="sc">==</span> <span class="st">"Ipsos"</span>, state <span class="sc">!=</span> <span class="st">"U.S."</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> enddate, <span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, adjpoll_clinton, adjpoll_trump)   </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(q_4a))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">state</th>
<th style="text-align: right;">adjpoll_clinton</th>
<th style="text-align: right;">adjpoll_trump</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alabama</td>
<td style="text-align: right;">37.54023</td>
<td style="text-align: right;">53.69718</td>
</tr>
<tr class="even">
<td style="text-align: left;">Arizona</td>
<td style="text-align: right;">41.35774</td>
<td style="text-align: right;">46.17779</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Arkansas</td>
<td style="text-align: right;">37.15339</td>
<td style="text-align: right;">53.28384</td>
</tr>
<tr class="even">
<td style="text-align: left;">California</td>
<td style="text-align: right;">58.33806</td>
<td style="text-align: right;">31.00473</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Colorado</td>
<td style="text-align: right;">46.00764</td>
<td style="text-align: right;">40.73571</td>
</tr>
<tr class="even">
<td style="text-align: left;">Connecticut</td>
<td style="text-align: right;">48.81810</td>
<td style="text-align: right;">38.87069</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
</section>
<section id="b.-combine-the-q_4a-dataset-with-the-q_1b-dataset-with-a-join-function.-the-resulting-dataset-should-only-have-47-rows.-create-the-following-new-variables-in-this-joined-dataset." class="level4">
<h4 class="anchored" data-anchor-id="b.-combine-the-q_4a-dataset-with-the-q_1b-dataset-with-a-join-function.-the-resulting-dataset-should-only-have-47-rows.-create-the-following-new-variables-in-this-joined-dataset."><strong>4b.</strong> Combine the q_4a dataset with the q_1b dataset with a join function. The resulting dataset should only have 47 rows. Create the following new variables in this joined dataset.</h4>
<p><code>polling_margin</code>: difference between <code>adjpoll_clinton</code> and <code>adjpoll_trump</code> <code>actual_margin</code>: difference between <code>clinton</code> and <code>trump</code> <code>polling_error</code>: difference between <code>polling_margin</code> and <code>actual_margin</code> <code>predicted_winner</code>: predicted winner based on <code>adjpoll_clinton</code> and <code>adjpoll_trump</code> <code>result = ifelse(winner == predicted_winner, "correct prediction", str_c("unexpected ", winner, " win"))</code> Keep only the columns <code>state</code>, polling_error, result, electoral_votes. Name the new dataset q_4b and show its first 6 rows.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>q_4b <span class="ot">&lt;-</span> q_4a <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(q_1b, <span class="at">by =</span> <span class="st">"state"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">polling_margin =</span> adjpoll_clinton <span class="sc">-</span> adjpoll_trump,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">actual_margin =</span> clinton <span class="sc">-</span> trump,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">polling_error =</span> polling_margin <span class="sc">-</span> actual_margin,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">predicted_winner =</span> <span class="fu">ifelse</span>(adjpoll_clinton <span class="sc">&gt;</span> adjpoll_trump, <span class="st">"clinton"</span>, <span class="st">"trump"</span>),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">result =</span> <span class="fu">ifelse</span>(winner <span class="sc">==</span> predicted_winner,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"correct prediction"</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">str_c</span>(<span class="st">"unexpected "</span>, winner, <span class="st">" win"</span>))</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, polling_error, result, electoral_votes)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(q_4b))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">state</th>
<th style="text-align: right;">polling_error</th>
<th style="text-align: left;">result</th>
<th style="text-align: right;">electoral_votes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alabama</td>
<td style="text-align: right;">11.5681966</td>
<td style="text-align: left;">correct prediction</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Arizona</td>
<td style="text-align: right;">-1.3173239</td>
<td style="text-align: left;">correct prediction</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Arkansas</td>
<td style="text-align: right;">10.7895518</td>
<td style="text-align: left;">correct prediction</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">California</td>
<td style="text-align: right;">-2.7759631</td>
<td style="text-align: left;">correct prediction</td>
<td style="text-align: right;">55</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Colorado</td>
<td style="text-align: right;">0.3663946</td>
<td style="text-align: left;">correct prediction</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Connecticut</td>
<td style="text-align: right;">-3.6919767</td>
<td style="text-align: left;">correct prediction</td>
<td style="text-align: right;">7</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="c.-generate-the-following-plot-with-the-q_4b-dataset.-use-chunk-options-to-adjust-the-dimensions-of-the-plot-to-make-it-longer-than-the-default-dimension.-based-on-this-plot-where-did-the-polls-get-wrong-in-the-2016-election" class="level4">
<h4 class="anchored" data-anchor-id="c.-generate-the-following-plot-with-the-q_4b-dataset.-use-chunk-options-to-adjust-the-dimensions-of-the-plot-to-make-it-longer-than-the-default-dimension.-based-on-this-plot-where-did-the-polls-get-wrong-in-the-2016-election"><strong>4c.</strong> Generate the following plot with the q_4b dataset. Use chunk options to adjust the dimensions of the plot to make it longer than the default dimension. Based on this plot, where did the polls get wrong in the 2016 election?</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(q_4b, <span class="fu">aes</span>(<span class="at">x =</span> polling_error, <span class="at">y =</span> <span class="fu">reorder</span>(state, polling_error))) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> electoral_votes, <span class="at">color =</span> result), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"correct prediction"</span> <span class="ot">=</span> <span class="st">"tomato"</span>, </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"unexpected trump win"</span> <span class="ot">=</span> <span class="st">"skyblue"</span>)) <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Polling Error (percentage points)"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"State"</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="st">"electoral_votes"</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"result"</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Polling Errors in the 2016 U.S. Election (Ipsos Polls)"</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="assignment_7_files/figure-html/label22-1.png" class="img-fluid" width="672"></p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>